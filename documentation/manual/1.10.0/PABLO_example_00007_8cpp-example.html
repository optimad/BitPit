---
layout: doxygen_header
title: Manual - PABLO_example_00007.cpp
section: documentation
doxygen-show-titlearea: 0
extra-head-includes:
    - doxygen_extra_head.html
---
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
{% if page.doxygen-show-titlearea == 1 %}
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">bitpit
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
{% endif %}
<!-- end header part -->
{% raw %}
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">PABLO_example_00007.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>Parallel 2D adaptive mesh refinement (AMR) with data using PABLO.</p>
<p>Parallel 2D adaptive mesh refinement (AMR) with data using PABLO The example is the parallel version of PABLO_example_00004.</p>
<p>Here the main focus is on the load-balance of both grid and data. The grid is refined several times together with the data and their inheritance follows the same rules like in example 00004. Until the last refinement no parallel paradigm is in action: every process owns the entire grid.</p>
<p>After this refinement, the load-balance with data is introduced, giving as result a parallel distribution of grid and data.</p>
<p>Even a constant vector of weight is used, in order to show that the loadBalance can be performed by using a weight function for each cell.</p>
<p>The user data communication interfaces are based on the Couriously Recurrent Template Pattern. The user has to implement a specification of the interface by writing a derived class. In the files <a class="el" href="PABLO__userDataLB_8hpp_source.html">PABLO_userDataLB.hpp</a> and <a class="el" href="PABLO__userDataLB_8tpp_source.html">PABLO_userDataLB.tpp</a> an example of this specification is given in the case of user data stored in a POD container similar to the STL vector.</p>
<p>The class in <a class="el" href="PABLO__userDataLB_8hpp_source.html">PABLO_userDataLB.hpp</a> is an example of user specification of the load blance data communication interface based on the Curiously Recurrent Template Pattern. The user has to implement his interface class(es) in order to define how his data have to be written and read in the communication buffer. These classes have to be derived from the template base class <a class="el" href="classbitpit_1_1DataLBInterface.html" title="Base class for data communications.">bitpit::DataLBInterface</a> using as template argument value the derived class. Like this, </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">class </span>UserDataLB : <span class="keyword">public</span> <a id="_a0" name="_a0"></a><a class="code hl_class" href="classbitpit_1_1DataLBInterface.html">bitpit::DataLBInterface</a>&lt;UserDataLB&lt;D&gt; &gt;</div>
<div class="ttc" id="aclassbitpit_1_1DataLBInterface_html"><div class="ttname"><a href="classbitpit_1_1DataLBInterface.html">bitpit::DataLBInterface</a></div><div class="ttdoc">Base class for data communications.</div><div class="ttdef"><b>Definition</b> <a href="DataLBInterface_8hpp_source.html#l00070">DataLBInterface.hpp:70</a></div></div>
</div><!-- fragment --><p>The choice of the members of the class is completely up to the user and they have to be useful to access both internal and ghost data container. In the example user data datatype is given as template parameter in order to pass any container similar to the STL vector.</p>
<p>In any case, the user must at least implement all the methods reported in this example:</p><ul>
<li><b><code>size_t fixedsize()</code> method:</b> this method is automatically called by the manager and it is intended to define the constant size of the data to be communicated per grid element. If all the element of the grid communicate the same size of data, this method must return a value different from zero and equal to the number of byte to be communicated for every element. Otherwise, it must return zero and the different data size for each element must be specified by the size method. Example: <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">size_t</span> UserDataLB&lt;D&gt;::size(<span class="keyword">const</span> uint32_t e)<span class="keyword"> const </span>{</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="section return"><dt>Returns</dt><dd>the size in bytes of the data to be communicated for every element</dd></dl>
</li>
<li><b><code>size_t size(const uint32_t e)</code> method:</b> this method is automatically called by the manager and it is intended to define the variable size of the data to be communicated of every grid element. In order to make the manager use this method, the fixedsize method has to return zero. Implementing this method, the user can pass to the manager the specific data size to be communicated for the element e. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">size_t</span> UserDataLB&lt;D&gt;::size(<span class="keyword">const</span> uint32_t e)<span class="keyword"> const </span>{</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(double);</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">index</td><td>of the internal element to be communicated. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the size in bytes of the data tobe communicated for the element e</dd></dl>
</li>
<li><b><code> void move(const uint32_t from, const uint32_t to)</code> method:</b> this method is automatically called by the manager and it is intended to move data inside the internal data container. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> UserDataLB&lt;D&gt;::move(<span class="keyword">const</span> uint32_t from, <span class="keyword">const</span> uint32_t to) {</div>
<div class="line">  data[to] = data[from];</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">from</td><td>index of the element whose data have to be moved to to. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">to</td><td>index of the element where the from data have to be placed in.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><b><code>void gather(Buffer&amp; buff, const uint32_t e)</code> method: </b> this method is automatically called by the manager and it is intended to write user data to the char communication buffer. The user has to specify in its implementation the way data can be read from the char buffer. The manager provide the user with a buffer and its read method in order to simply read POD data from the buffer. The user has to define the way his data can be read from the buffer by decomposing them in POD data and by using the buffer read method to take them from the buffer and to store them in the ghost data container. In this example we suppose that data is a container of POD data having the random access operator. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Buffer&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> UserDataLB&lt;D&gt;::gather(Buffer&amp; buff, <span class="keyword">const</span> uint32_t e) {</div>
<div class="line">  buff.write(data[e]);</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">e</td><td>index of the ghost element to be communicated. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buff</td><td>is the char buffer used to communicate user data. The user has not to take care of the buffer, but its method write and read. These methods are intended to write/read POD data to/fromthe buffer.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><b><code>void scatter(Buffer&amp; buff, const uint32_t e)</code> method: </b> this method is automatically called by the manager and it is intended to read user data from the char communication buffer and store them in the data container. The user has to specify in its implementation the way data can be read from the char buffer. The manager provide the user with a buffer and its read method in order to simply read POD data from the buffer. The user has to define the way his data can be read from the buffer by decomposing them in POD data and by using the buffer read method to take them from the buffer and to store them in the ghost data container. In this example we suppose that data is a container of POD data having the random access operator. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Buffer&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> UserDataLB&lt;D&gt;::scatter(Buffer&amp; buff, <span class="keyword">const</span> uint32_t e) {</div>
<div class="line">  buff.read(data[e]);</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">e</td><td>index of the element to be communicated. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buff</td><td>is the char buffer used to communicate user data. The user has not to take care of the buffer, but its method write and read. These methods are intended to write/read POD data to/fromthe buffer.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><b><code>void assign(uint32_t stride, uint32_t length)</code> method: </b> this method is automatically called by the manager and it intended to be used during the static load balance. At the beginning of any application of the this manager, the entire grid is on every MPI process. At the first load balance the grid is partitioned and distributed to the processes. <a class="el" href="classData.html">Data</a> are distributed using this method, by assigning the right length to the the process starting from the right stride. The user has to tell the manager how to start reading the length of data from the stride position and how to put only these data in the same container, deleting the rest. It is a restriction operation of the container to a contiguous part of it. In this examples data is supposed to be a container with the assign operator, as std::vector. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> UserDataLB&lt;D&gt;::assign(uint32_t stride, uint32_t length) {</div>
<div class="line">  <a id="_a1" name="_a1"></a><a class="code hl_class" href="classData.html">Data</a> dataCopy = data;</div>
<div class="line">  <span class="keyword">typename</span> Data::iterator first = dataCopy.begin() + stride;</div>
<div class="line">  <span class="keyword">typename</span> Data::iterator last = first + length;</div>
<div class="line">  data.assign(first,last);</div>
<div class="line"><span class="preprocessor">#if defined(__INTEL_COMPILER)</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  data.shrink_to_fit();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  first = dataCopy.end();</div>
<div class="line">  last = dataCopy.end();</div>
<div class="line">};</div>
<div class="ttc" id="aclassData_html"><div class="ttname"><a href="classData.html">Data</a></div><div class="ttdef"><b>Definition</b> <a href="PABLO__example__00006_8cpp_source.html#l00123">PABLO_example_00006.cpp:123</a></div></div>
</div><!-- fragment --> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">stride</td><td>the initial position of the data to be</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><b><code>void resize(uint32_t newSize)</code> method: </b> this method is automatically called by the manager and it intended to be used during the static and the dynamic load balance. During the load balance process the user data container has to change its size to adapt itself to the new partition of the domain. The user has to tell the manager how to change the size of his data containers. In this examples data is supposed to be a container with the resize operator, as std::vector. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> UserDataLB&lt;D&gt;::resize(uint32_t newSize) {</div>
<div class="line">  data.resize(newSize);</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">newSize</td><td>is the new size of the container</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><b><code>void resizeGhost(uint32_t newSize)</code> method: </b> this method is automatically called by the manager and it intended to be used during the static and the dynamic load balance. During the load balance process the ghost user data container has to change its size to adapt itself to the new partition of the domain. The user has to tell the manager how to change the size of his ghost data containers. In this examples data is supposed to be a container with the resize operator, as std::vector. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> UserDataLB&lt;D&gt;::resizeGhost(uint32_t newSize) {</div>
<div class="line">  ghostdata.resize(newSize);</div>
<div class="line">}</div>
</div><!-- fragment --> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">newSize</td><td>is the new size of the container</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><b><code>void shrink()</code> method: </b> this method is automatically called by the manager and it intended to be used during the static and the dynamic load balance. During the load balance process the user data container changes its size to adapt itself to the new partition of the domain. If the container can change its size and its capacity separately, this method is intended to get the container capacity equal to its size The user has to tell the manager how to change the capacity of his data containers to its size. In this examples data is supposed to be a container with the shrink_to_fit operator, as std::vector. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> UserDataLB&lt;D&gt;::shrink() {</div>
<div class="line"><span class="preprocessor">#if defined(__INTEL_COMPILER)</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  data.shrink_to_fit();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
</div><!-- fragment --></li>
</ul>
<p><b><code>UserDataLB(Data&amp; data_, Data&amp; ghostdata_)</code> the constructor method: </b> this method has to be called by the user in his application code. The user is free to implement his constructors as he wants, but he must guarantee the access to the internal and ghost data. </p><div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">inline</span> UserDataLB&lt;D&gt;::UserDataLB(<a class="code hl_class" href="classData.html">Data</a>&amp; data_, <a class="code hl_class" href="classData.html">Data</a>&amp; ghostdata_) : data(data_), ghostdata(ghostdata_){}</div>
</div><!-- fragment --><p>In the code of this example application, pay attention to the use of the interface </p><div class="fragment"><div class="line">UserDataLB&lt;vector&lt;double&gt; &gt; data_lb(weight,weightGhost);</div>
<div class="line">pablo7.loadBalance(data_lb, &amp;weight);</div>
</div><!-- fragment --><p><b>To run</b>: ./PABLO_example_00007 <br  />
 <b>To see the result visit</b>: <a href="http://optimad.github.io/PABLO/">PABLO website</a> <br  />
 </p><div class="fragment"><div class="line"><span class="comment">/*---------------------------------------------------------------------------*\</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  bitpit</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  Copyright (C) 2015-2021 OPTIMAD engineering Srl</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  -------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *  License</span></div>
<div class="line"><span class="comment"> *  This file is part of bitpit.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  bitpit is free software: you can redistribute it and/or modify it</span></div>
<div class="line"><span class="comment"> *  under the terms of the GNU Lesser General Public License v3 (LGPL)</span></div>
<div class="line"><span class="comment"> *  as published by the Free Software Foundation.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  bitpit is distributed in the hope that it will be useful, but WITHOUT</span></div>
<div class="line"><span class="comment"> *  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div>
<div class="line"><span class="comment"> *  FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public</span></div>
<div class="line"><span class="comment"> *  License for more details.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span></div>
<div class="line"><span class="comment"> *  along with bitpit. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment">\*---------------------------------------------------------------------------*/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;bitpit_PABLO.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line"><span class="preprocessor">#include &quot;PABLO_userDataComm.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;PABLO_userDataLB.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"><span class="keyword">using namespace </span>bitpit;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// =================================================================================== //</span></div>
<div class="line"><span class="comment">// =================================================================================== //</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line"><span class="preprocessor">#include &lt;mpi.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;bitpit_PABLO.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> run()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> iter = 0;</div>
<div class="line"> </div>
<div class="line">    <a id="_a2" name="_a2"></a><a class="code hl_class" href="classbitpit_1_1PabloUniform.html">PabloUniform</a> pablo7(2);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> idx = 0;</div>
<div class="line">    pablo7.<a id="a3" name="a3"></a><a class="code hl_function" href="classbitpit_1_1ParaTree.html#adb875937b6ccc0473c48b66b73bf13d9">setBalance</a>(idx,<span class="keyword">false</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (iter=1; iter&lt;6; iter++){</div>
<div class="line">        pablo7.<a id="a4" name="a4"></a><a class="code hl_function" href="classbitpit_1_1ParaTree.html#a5eacb88f2324b915ba8dbac95c994755">adaptGlobalRefine</a>();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> xc, yc;</div>
<div class="line">    xc = yc = 0.5;</div>
<div class="line">    <span class="keywordtype">double</span> radius = 0.25;</div>
<div class="line"> </div>
<div class="line">    uint32_t nocts = pablo7.<a id="a5" name="a5"></a><a class="code hl_function" href="classbitpit_1_1ParaTree.html#a1494818960f36f09090597a10eac9fff">getNumOctants</a>();</div>
<div class="line">    uint32_t nghosts = pablo7.<a id="a6" name="a6"></a><a class="code hl_function" href="classbitpit_1_1ParaTree.html#aa21e264f23bc71a9c15810a667413bf7">getNumGhosts</a>();</div>
<div class="line">    vector&lt;double&gt; oct_data(nocts, 0.0), ghost_data(nghosts, 0.0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nocts; i++){</div>
<div class="line">        vector&lt;array&lt;double,3&gt; &gt; nodes = pablo7.<a id="a7" name="a7"></a><a class="code hl_function" href="classbitpit_1_1PabloUniform.html#a351114f73d1f3468fe9a393e9a1dae4c">getNodes</a>(i);</div>
<div class="line">        array&lt;double,3&gt; center = pablo7.<a id="a8" name="a8"></a><a class="code hl_function" href="classbitpit_1_1PabloUniform.html#ac92c812eea07309bc35334f7ef32e368">getCenter</a>(i);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;4; j++){</div>
<div class="line">            <span class="keywordtype">double</span> x = nodes[j][0];</div>
<div class="line">            <span class="keywordtype">double</span> y = nodes[j][1];</div>
<div class="line">            <span class="keywordflow">if</span> ((<a id="a9" name="a9"></a><a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>((x-xc),2.0)+<a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>((y-yc),2.0) &lt;= <a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>(radius,2.0))){</div>
<div class="line">                oct_data[i] = (<a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>((center[0]-xc),2.0)+<a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>((center[1]-yc),2.0));</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    iter = 0;</div>
<div class="line">    pablo7.<a id="a10" name="a10"></a><a class="code hl_function" href="classbitpit_1_1ParaTree.html#ab4aa4521f6f8b2c046ad2bcb57bf568d">updateConnectivity</a>();</div>
<div class="line">    pablo7.<a id="a11" name="a11"></a><a class="code hl_function" href="classbitpit_1_1PabloUniform.html#a913ca3169798d3078dd2d5abf67c2e69">writeTest</a>(<span class="stringliteral">&quot;pablo00007_iter&quot;</span>+to_string(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(iter)), oct_data);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> start = 1;</div>
<div class="line">    vector&lt;double&gt; weight(nocts, 1.0),weightGhost;</div>
<div class="line">    <span class="keywordflow">for</span> (iter=start; iter&lt;start+2; iter++){</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nocts; i++){</div>
<div class="line">            vector&lt;array&lt;double,3&gt; &gt; nodes = pablo7.<a class="code hl_function" href="classbitpit_1_1PabloUniform.html#a351114f73d1f3468fe9a393e9a1dae4c">getNodes</a>(i);</div>
<div class="line">            array&lt;double,3&gt; center = pablo7.<a class="code hl_function" href="classbitpit_1_1PabloUniform.html#ac92c812eea07309bc35334f7ef32e368">getCenter</a>(i);</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;4; j++){</div>
<div class="line">                weight[i] = 2.0;</div>
<div class="line">                <span class="keywordtype">double</span> x = nodes[j][0];</div>
<div class="line">                <span class="keywordtype">double</span> y = nodes[j][1];</div>
<div class="line">                <span class="keywordflow">if</span> ((<a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>((x-xc),2.0)+<a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>((y-yc),2.0) &lt;= <a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>(radius,2.0))){</div>
<div class="line">                    <span class="keywordflow">if</span> (center[0]&lt;=xc){</div>
<div class="line"> </div>
<div class="line">                        pablo7.<a id="a12" name="a12"></a><a class="code hl_function" href="classbitpit_1_1ParaTree.html#a0d210b4659cca3b083f6f07aa30577a7">setMarker</a>(i,1);</div>
<div class="line">                        weight[i] = 1.0;</div>
<div class="line">                    }</div>
<div class="line">                    <span class="keywordflow">else</span>{</div>
<div class="line"> </div>
<div class="line">                        pablo7.<a class="code hl_function" href="classbitpit_1_1ParaTree.html#a0d210b4659cca3b083f6f07aa30577a7">setMarker</a>(i,-1);</div>
<div class="line">                        weight[i] = 1.0;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        vector&lt;double&gt; oct_data_new;</div>
<div class="line">        vector&lt;double&gt; weight_new;</div>
<div class="line">        vector&lt;uint32_t&gt; mapper;</div>
<div class="line">        vector&lt;bool&gt; isghost;</div>
<div class="line">        pablo7.<a id="a13" name="a13"></a><a class="code hl_function" href="classbitpit_1_1ParaTree.html#a234a7e3bb6fdb72c14d6cdcaafda8395">adapt</a>(<span class="keyword">true</span>);</div>
<div class="line">        nocts = pablo7.<a class="code hl_function" href="classbitpit_1_1ParaTree.html#a1494818960f36f09090597a10eac9fff">getNumOctants</a>();</div>
<div class="line">        oct_data_new.resize(nocts, 0.0);</div>
<div class="line">        weight_new.resize(nocts,0.0);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">for</span> (uint32_t i=0; i&lt;nocts; i++){</div>
<div class="line">            pablo7.<a id="a14" name="a14"></a><a class="code hl_function" href="classbitpit_1_1ParaTree.html#a303215f8026bd03a1b2cc8a506a3622b">getMapping</a>(i, mapper, isghost);</div>
<div class="line">            <span class="keywordflow">if</span> (pablo7.<a id="a15" name="a15"></a><a class="code hl_function" href="classbitpit_1_1ParaTree.html#aca0186f5b2b1c978f0c42e3eeb9c796a">getIsNewC</a>(i)){</div>
<div class="line">                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;4; j++){</div>
<div class="line">                    oct_data_new[i] += oct_data[mapper[j]]/4;</div>
<div class="line">                    weight_new[i] += weight[mapper[j]];</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pablo7.<a id="a16" name="a16"></a><a class="code hl_function" href="classbitpit_1_1ParaTree.html#aff8443d85043f3e68b652ffa0c2643bb">getIsNewR</a>(i)){</div>
<div class="line">                oct_data_new[i] += oct_data[mapper[0]];</div>
<div class="line">                weight_new[i] += weight[mapper[0]];</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span>{</div>
<div class="line">                oct_data_new[i] += oct_data[mapper[0]];</div>
<div class="line">                weight_new[i] += weight[mapper[0]];</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        pablo7.<a class="code hl_function" href="classbitpit_1_1ParaTree.html#ab4aa4521f6f8b2c046ad2bcb57bf568d">updateConnectivity</a>();</div>
<div class="line">        pablo7.<a class="code hl_function" href="classbitpit_1_1PabloUniform.html#a913ca3169798d3078dd2d5abf67c2e69">writeTest</a>(<span class="stringliteral">&quot;pablo00007_iter&quot;</span>+to_string(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(iter)), oct_data_new);</div>
<div class="line"> </div>
<div class="line">        oct_data = oct_data_new;</div>
<div class="line">        weight = weight_new;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">    UserDataLB&lt;vector&lt;double&gt; &gt; data_lb(weight,weightGhost);</div>
<div class="line">    pablo7.<a id="a17" name="a17"></a><a class="code hl_function" href="classbitpit_1_1ParaTree.html#a3b91986335d8d4324fc378118920f1d9">loadBalance</a>(data_lb, &amp;weight);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> tot = 0.0;</div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;weight.size(); i++){</div>
<div class="line">        tot += weight[i];</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    pablo7.<a class="code hl_function" href="classbitpit_1_1ParaTree.html#ab4aa4521f6f8b2c046ad2bcb57bf568d">updateConnectivity</a>();</div>
<div class="line">    pablo7.<a class="code hl_function" href="classbitpit_1_1PabloUniform.html#a913ca3169798d3078dd2d5abf67c2e69">writeTest</a>(<span class="stringliteral">&quot;pablo00007_iter&quot;</span>+to_string(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(iter)), weight);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">    MPI_Init(&amp;argc,&amp;argv);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <a id="a18" name="a18"></a><a class="code hl_define" href="group__common__macro.html#gacb5eef7cdb2adda3b65bfe01c66667a4">BITPIT_UNUSED</a>(argc);</div>
<div class="line">    <a class="code hl_define" href="group__common__macro.html#gacb5eef7cdb2adda3b65bfe01c66667a4">BITPIT_UNUSED</a>(argv);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> nProcs;</div>
<div class="line">    <span class="keywordtype">int</span> rank;</div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;nProcs);</div>
<div class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    nProcs = 1;</div>
<div class="line">    rank   = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize the logger</span></div>
<div class="line">    log::manager().initialize(log::MODE_SEPARATE, <span class="keyword">false</span>, nProcs, rank);</div>
<div class="line">    log::cout() &lt;&lt; log::fileVerbosity(log::LEVEL_INFO);</div>
<div class="line">    log::cout() &lt;&lt; log::disableConsole();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run the example</span></div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        run();</div>
<div class="line">    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;exception) {</div>
<div class="line">        log::cout() &lt;&lt; exception.what();</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">    MPI_Finalize();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassbitpit_1_1PabloUniform_html"><div class="ttname"><a href="classbitpit_1_1PabloUniform.html">bitpit::PabloUniform</a></div><div class="ttdoc">PABLO Uniform is an example of user class derived from ParaTree to map ParaTree in a uniform (square/...</div><div class="ttdef"><b>Definition</b> <a href="PabloUniform_8hpp_source.html#l00061">PabloUniform.hpp:62</a></div></div>
<div class="ttc" id="aclassbitpit_1_1PabloUniform_html_a351114f73d1f3468fe9a393e9a1dae4c"><div class="ttname"><a href="classbitpit_1_1PabloUniform.html#a351114f73d1f3468fe9a393e9a1dae4c">bitpit::PabloUniform::getNodes</a></div><div class="ttdeci">void getNodes(uint32_t idx, darr3vector &amp;nodes) const</div><div class="ttdef"><b>Definition</b> <a href="PabloUniform_8cpp_source.html#l00405">PabloUniform.cpp:405</a></div></div>
<div class="ttc" id="aclassbitpit_1_1PabloUniform_html_a913ca3169798d3078dd2d5abf67c2e69"><div class="ttname"><a href="classbitpit_1_1PabloUniform.html#a913ca3169798d3078dd2d5abf67c2e69">bitpit::PabloUniform::writeTest</a></div><div class="ttdeci">void writeTest(const std::string &amp;filename, dvector data)</div><div class="ttdef"><b>Definition</b> <a href="PabloUniform_8cpp_source.html#l01035">PabloUniform.cpp:1035</a></div></div>
<div class="ttc" id="aclassbitpit_1_1PabloUniform_html_ac92c812eea07309bc35334f7ef32e368"><div class="ttname"><a href="classbitpit_1_1PabloUniform.html#ac92c812eea07309bc35334f7ef32e368">bitpit::PabloUniform::getCenter</a></div><div class="ttdeci">void getCenter(uint32_t idx, darray3 &amp;center) const</div><div class="ttdef"><b>Definition</b> <a href="PabloUniform_8cpp_source.html#l00323">PabloUniform.cpp:323</a></div></div>
<div class="ttc" id="aclassbitpit_1_1ParaTree_html_a0d210b4659cca3b083f6f07aa30577a7"><div class="ttname"><a href="classbitpit_1_1ParaTree.html#a0d210b4659cca3b083f6f07aa30577a7">bitpit::ParaTree::setMarker</a></div><div class="ttdeci">void setMarker(uint32_t idx, int8_t marker)</div><div class="ttdef"><b>Definition</b> <a href="ParaTree_8cpp_source.html#l01696">ParaTree.cpp:1696</a></div></div>
<div class="ttc" id="aclassbitpit_1_1ParaTree_html_a1494818960f36f09090597a10eac9fff"><div class="ttname"><a href="classbitpit_1_1ParaTree.html#a1494818960f36f09090597a10eac9fff">bitpit::ParaTree::getNumOctants</a></div><div class="ttdeci">uint32_t getNumOctants() const</div><div class="ttdef"><b>Definition</b> <a href="ParaTree_8cpp_source.html#l02118">ParaTree.cpp:2118</a></div></div>
<div class="ttc" id="aclassbitpit_1_1ParaTree_html_a234a7e3bb6fdb72c14d6cdcaafda8395"><div class="ttname"><a href="classbitpit_1_1ParaTree.html#a234a7e3bb6fdb72c14d6cdcaafda8395">bitpit::ParaTree::adapt</a></div><div class="ttdeci">bool adapt(bool mapper_flag=false)</div><div class="ttdef"><b>Definition</b> <a href="ParaTree_8cpp_source.html#l03698">ParaTree.cpp:3698</a></div></div>
<div class="ttc" id="aclassbitpit_1_1ParaTree_html_a303215f8026bd03a1b2cc8a506a3622b"><div class="ttname"><a href="classbitpit_1_1ParaTree.html#a303215f8026bd03a1b2cc8a506a3622b">bitpit::ParaTree::getMapping</a></div><div class="ttdeci">void getMapping(uint32_t idx, u32vector &amp;mapper, bvector &amp;isghost) const</div><div class="ttdef"><b>Definition</b> <a href="ParaTree_8cpp_source.html#l03355">ParaTree.cpp:3355</a></div></div>
<div class="ttc" id="aclassbitpit_1_1ParaTree_html_a3b91986335d8d4324fc378118920f1d9"><div class="ttname"><a href="classbitpit_1_1ParaTree.html#a3b91986335d8d4324fc378118920f1d9">bitpit::ParaTree::loadBalance</a></div><div class="ttdeci">void loadBalance(const dvector *weight=NULL)</div><div class="ttdef"><b>Definition</b> <a href="ParaTree_8cpp_source.html#l04137">ParaTree.cpp:4137</a></div></div>
<div class="ttc" id="aclassbitpit_1_1ParaTree_html_a5eacb88f2324b915ba8dbac95c994755"><div class="ttname"><a href="classbitpit_1_1ParaTree.html#a5eacb88f2324b915ba8dbac95c994755">bitpit::ParaTree::adaptGlobalRefine</a></div><div class="ttdeci">bool adaptGlobalRefine(bool mapper_flag=false)</div><div class="ttdef"><b>Definition</b> <a href="ParaTree_8cpp_source.html#l03713">ParaTree.cpp:3713</a></div></div>
<div class="ttc" id="aclassbitpit_1_1ParaTree_html_aa21e264f23bc71a9c15810a667413bf7"><div class="ttname"><a href="classbitpit_1_1ParaTree.html#aa21e264f23bc71a9c15810a667413bf7">bitpit::ParaTree::getNumGhosts</a></div><div class="ttdeci">uint32_t getNumGhosts() const</div><div class="ttdef"><b>Definition</b> <a href="ParaTree_8cpp_source.html#l02126">ParaTree.cpp:2126</a></div></div>
<div class="ttc" id="aclassbitpit_1_1ParaTree_html_ab4aa4521f6f8b2c046ad2bcb57bf568d"><div class="ttname"><a href="classbitpit_1_1ParaTree.html#ab4aa4521f6f8b2c046ad2bcb57bf568d">bitpit::ParaTree::updateConnectivity</a></div><div class="ttdeci">void updateConnectivity()</div><div class="ttdef"><b>Definition</b> <a href="ParaTree_8cpp_source.html#l03972">ParaTree.cpp:3972</a></div></div>
<div class="ttc" id="aclassbitpit_1_1ParaTree_html_aca0186f5b2b1c978f0c42e3eeb9c796a"><div class="ttname"><a href="classbitpit_1_1ParaTree.html#aca0186f5b2b1c978f0c42e3eeb9c796a">bitpit::ParaTree::getIsNewC</a></div><div class="ttdeci">bool getIsNewC(uint32_t idx) const</div><div class="ttdef"><b>Definition</b> <a href="ParaTree_8cpp_source.html#l01566">ParaTree.cpp:1566</a></div></div>
<div class="ttc" id="aclassbitpit_1_1ParaTree_html_adb875937b6ccc0473c48b66b73bf13d9"><div class="ttname"><a href="classbitpit_1_1ParaTree.html#adb875937b6ccc0473c48b66b73bf13d9">bitpit::ParaTree::setBalance</a></div><div class="ttdeci">void setBalance(uint32_t idx, bool balance)</div><div class="ttdef"><b>Definition</b> <a href="ParaTree_8cpp_source.html#l01709">ParaTree.cpp:1709</a></div></div>
<div class="ttc" id="aclassbitpit_1_1ParaTree_html_aff8443d85043f3e68b652ffa0c2643bb"><div class="ttname"><a href="classbitpit_1_1ParaTree.html#aff8443d85043f3e68b652ffa0c2643bb">bitpit::ParaTree::getIsNewR</a></div><div class="ttdeci">bool getIsNewR(uint32_t idx) const</div><div class="ttdef"><b>Definition</b> <a href="ParaTree_8cpp_source.html#l01557">ParaTree.cpp:1557</a></div></div>
<div class="ttc" id="agroup__MathFunctions_html_gaf8584ed85f67d3f84fcbb39e3045a820"><div class="ttname"><a href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a></div><div class="ttdeci">std::array&lt; T, d &gt; pow(std::array&lt; T, d &gt; &amp;x, double p)</div><div class="ttdef"><b>Definition</b> <a href="MathOperators__array_8tpp_source.html#l00637">MathOperators_array.tpp:637</a></div></div>
<div class="ttc" id="agroup__common__macro_html_gacb5eef7cdb2adda3b65bfe01c66667a4"><div class="ttname"><a href="group__common__macro.html#gacb5eef7cdb2adda3b65bfe01c66667a4">BITPIT_UNUSED</a></div><div class="ttdeci">#define BITPIT_UNUSED(variable)</div><div class="ttdef"><b>Definition</b> <a href="compiler_8hpp_source.html#l00063">compiler.hpp:63</a></div></div>
</div><!-- fragment --> </div><!-- contents -->
---
layout: doxygen_footer
---
{% endraw %}
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<address class="footer"><small>
Generated on Fri Apr 26 2024 10:45:52 for bitpit by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.10.0
</small></address>
