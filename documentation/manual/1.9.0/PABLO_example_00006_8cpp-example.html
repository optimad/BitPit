
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="description" content="bitpit is a C++ library for scientific High Performance Computing." />
    <meta name="keywords" content="bitpit, HPC, octree, PABLO, levelset, RBF, mesh, grid" />
    <link rel="shortcut icon" href="/bitpit/images/bitpit.ico" type="image/x-icon">
    <link rel="icon" href="/bitpit/images/bitpit.ico" type="image/x-icon">
    <link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Lato:400,700'>
    <link rel="stylesheet" type="text/css" href="/bitpit/stylesheets/normalize.css" />
    <link rel="stylesheet" type="text/css" href="/bitpit/stylesheets/base.css" />
    <link rel="stylesheet" type="text/css" href="/bitpit/stylesheets/cookies.css" />
    <script type="text/javascript" src="/bitpit/scripts/jquery-1.12.4.min.js"></script>
    <script type="text/javascript" src="/bitpit/scripts/cookies.js"></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-93686152-1', 'auto');
        ga('send', 'pageview');
    </script>
    <script type="text/javascript">
        $(document).ready(function(){
        });
    </script>
    <meta name="generator" content="Doxygen 1.9.6"/>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="manual.css" rel="stylesheet" type="text/css"/>
    <title>bitpit - Manual - PABLO_example_00006.cpp</title>
</head>
<body>
<div id="cookie-warning">
        <p id="accept-cookies" class="button">Continue</p>
        <h3>Our website uses cookies</h3>
        <p>
        This website uses cookies. By continuing to use this website you are
        giving consent to cookies being used. For information on cookies
        and how you can disable them visit our
        <a href="/bitpit/privacy.html">Privacy Policy</a>.
        </p>
</div>
<!-- Header-->
<div id="header" class="">
    <div class="logo"><a href="/bitpit">&nbsp;</a></div>
    <div class="menu-line"></div>
<ul class="menu">
    <li>
        <a href="/bitpit/modules/index.html">Overview</a>
    </li>
    <li class="current">
        <span>Documentation</span>
        <ul class="sub-menu">
            <li><a href="/bitpit/documentation/installation.html">Installation guide</a></li>
            <li><a href="/bitpit/documentation/manual/1.9.0/index.html">Programmer's manual</a></li>
        </ul>
    </li>
    <li>
        <a href="/bitpit/downloads">Downloads</a>
    </li>
</ul>
<script type="text/javascript">
$('.menu li').hover(
    function() {
        $('ul', this).css('height', 'auto');
        $('ul', this).stop().slideDown(200);
    },
    function() {
        $('ul', this).stop().slideUp(200, function() {
            $(this).attr('style','');
        });
    }
);
</script>
</div>
<div id="content" class="">
<div id="manual">
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">PABLO_example_00006.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>Parallel 2D smoothing data using PABLO.</p>
<p>The example is the parallel version of PABLO_example_00003.</p>
<p>In order to perform the smoothing procedure in parallel, ghost elements and data communications towards them are needed. Now ghost quadrants and ghost data are not only instantiated, as in example 00003, but actually used to perform smoothing across process borders.</p>
<p>The user data communication interfaces are based on the Couriously Recurrent Template Pattern. The user has to implement a specification of the interface by writing a derived class. In the files <a class="el" href="PABLO__userDataComm_8hpp_source.html">PABLO_userDataComm.hpp</a> and <a class="el" href="PABLO__userDataComm_8tpp_source.html">PABLO_userDataComm.tpp</a> an example of this specification is given in the case of user data stored in a POD container similar to the STL vector.</p>
<p>The class in <a class="el" href="PABLO__userDataComm_8hpp_source.html">PABLO_userDataComm.hpp</a> is an example of user specification of the data communication interface based on the Curiously Recurrent Template Pattern. The user has to implement his interface class(es) in order to define how his data have to be written and read in the communication buffer. These classes have to be derived from the template base class <a class="el" href="classbitpit_1_1DataCommInterface.html" title="Base class for data communications.">bitpit::DataCommInterface</a> using as template argument value the derived class. Like this, </p><div class="fragment"><div class="line"><span class="keyword">template</span> &lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">class </span>UserDataComm : <span class="keyword">public</span> <a id="_a0" name="_a0"></a><a class="code hl_class" href="classbitpit_1_1DataCommInterface.html">bitpit::DataCommInterface</a>&lt; UserDataComm&lt;D&gt; &gt; {</div>
<div class="ttc" id="aclassbitpit_1_1DataCommInterface_html"><div class="ttname"><a href="classbitpit_1_1DataCommInterface.html">bitpit::DataCommInterface</a></div><div class="ttdoc">Base class for data communications.</div><div class="ttdef"><b>Definition:</b> <a href="DataCommInterface_8hpp_source.html#l00062">DataCommInterface.hpp:62</a></div></div>
</div><!-- fragment --><p>The choice of the members of the class is completely up to the user and they have to be useful to access both internal and ghost data container. In the example user data datatype is given as template parameter in order to pass any container similar to the STL vector.</p>
<p>In any case, the user must at least implement all the methods reported in this example:</p><ul>
<li><b><code>size_t fixedsize()</code> method:</b> this method is automatically called by the manager and it is intended to define the constant size of the data to be communicated per grid element. If all the element of the grid communicate the same size of data, this method must return a value different from zero and equal to the number of byte to be communicated for every element. Otherwise, it must return zero and the different data size for each element must be specified by the size method <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Data&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">size_t</span> UserDataComm&lt;Data&gt;::fixedSize()<span class="keyword"> const </span>{</div>
<div class="line"><span class="keywordflow">return</span> 0;</div>
<div class="line">};</div>
</div><!-- fragment --> <dl class="section return"><dt>Returns</dt><dd>the size in bytes of the data tobe communicated for every element</dd></dl>
</li>
<li><b><code>size_t size(const uint32_t e)</code> method:</b> this method is automatically called by the manager and it is intended to define the variable size of the data to be communicated of every grid element. In order to make the manager use this method, the fixedsize method has to return zero. Implementing this method, the user can pass the manager the specific data size to be communicated for the element e. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Data&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">size_t</span> UserDataComm&lt;Data&gt;::size(<span class="keyword">const</span> uint32_t e)<span class="keyword"> const </span>{</div>
<div class="line">  <span class="keywordflow">return</span> <span class="keyword">sizeof</span>(double);</div>
<div class="line">};</div>
</div><!-- fragment --> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">index</td><td>of the internal element to be communicated. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the size in bytes of the data tobe communicated for the element e</dd></dl>
</li>
<li><b><code>void gather(Buffer&amp; buff, const uint32_t e)</code> method: </b> this method is automatically called by the manager and it is intended to write user data to the char communication buffer. The user has to specify in its implementation the way data can be written in the char buffer. The manager provide the user with a buffer and a stream insertion (&lt;&lt;) operator in order to simply write POD data in the buffer. The user has to define the way his data can be written in the buffer by decomposing them in POD data and by using the stream insertion (&lt;&lt;) operator to store them in the buffer. In this example we suppose that data is a container of POD data having the random access operator. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Data&gt;</div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Buffer&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> UserDataComm&lt;Data&gt;::gather(Buffer&amp; buff, <span class="keyword">const</span> uint32_t e) {</div>
<div class="line">  buff &lt;&lt; data[e];</div>
<div class="line">};</div>
</div><!-- fragment --> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">e</td><td>index of the internal element to be communicated. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buff</td><td>is the char buffer used to communicate user data.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><b><code>void scatter(Buffer&amp; buff, const uint32_t e)</code> method: </b> this method is automatically called by the manager and it is intended to read user data from the char communication buffer and store them in the ghost data container. The user has to specify in its implementation the way data can be read from the char buffer. The manager provide the user with a buffer and its stream extraction (&gt;&gt;) operator in order to simply read POD data from the buffer. The user has to define the way his data can be read from the buffer by decomposing them in POD data and by using the buffer stream extraction (&gt;&gt;) operator to take them from the buffer and to store them in the ghost data container. In this example we suppose that ghostData is a container of POD data having the random access operator. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Data&gt;</div>
<div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> Buffer&gt;</div>
<div class="line"><span class="keyword">inline</span> <span class="keywordtype">void</span> UserDataComm&lt;Data&gt;::scatter(Buffer&amp; buff,   <span class="keyword">const</span> uint32_t e) {</div>
<div class="line">  buff &gt;&gt; ghostData[e];</div>
<div class="line">};</div>
</div><!-- fragment --> <dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">e</td><td>index of the ghost element to be communicated. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">buff</td><td>is the char buffer used to communicate user data. The user has not to take care of the buffer, but its method write and read. These methods are intended to write/read POD data to/fromthe buffer.</td></tr>
  </table>
  </dd>
</dl>
</li>
<li><b><code>UserDataComm(Data&amp; data_, Data&amp; ghostdata_)</code> the constructor method: </b> this method has to be called by the user in his application code. The user is free to implement his constructors as he wants, but he must guarantee the access to the internal and ghost data. <div class="fragment"><div class="line"><span class="keyword">template</span>&lt;<span class="keyword">class</span> D&gt;</div>
<div class="line"><span class="keyword">inline</span> UserDataComm&lt;D&gt;::UserDataComm(<a id="_a1" name="_a1"></a><a class="code hl_class" href="classData.html">Data</a>&amp; data_, <a class="code hl_class" href="classData.html">Data</a>&amp; ghostdata_) : data(data_), ghostdata(ghostdata_){}</div>
<div class="ttc" id="aclassData_html"><div class="ttname"><a href="classData.html">Data</a></div><div class="ttdef"><b>Definition:</b> <a href="PABLO__example__00006_8cpp_source.html#l00123">PABLO_example_00006.cpp:123</a></div></div>
</div><!-- fragment --></li>
</ul>
<p>In the code of this example application, pay attention to the use of the interface </p><div class="fragment"><div class="line">UserDataLB&lt;vector&lt;double&gt; &gt; data_lb(weight,weightGhost);</div>
<div class="line">pablo7.loadBalance(data_lb, &amp;weight);</div>
</div><!-- fragment --><p><b>To run</b>: ./PABLO_example_00006 <br  />
 <b>To see the result visit</b>: <a href="http://optimad.github.io/PABLO/">PABLO website</a> <br  />
 </p><div class="fragment"><div class="line"><span class="comment">/*---------------------------------------------------------------------------*\</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  bitpit</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  Copyright (C) 2015-2021 OPTIMAD engineering Srl</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  -------------------------------------------------------------------------</span></div>
<div class="line"><span class="comment"> *  License</span></div>
<div class="line"><span class="comment"> *  This file is part of bitpit.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  bitpit is free software: you can redistribute it and/or modify it</span></div>
<div class="line"><span class="comment"> *  under the terms of the GNU Lesser General Public License v3 (LGPL)</span></div>
<div class="line"><span class="comment"> *  as published by the Free Software Foundation.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  bitpit is distributed in the hope that it will be useful, but WITHOUT</span></div>
<div class="line"><span class="comment"> *  ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span></div>
<div class="line"><span class="comment"> *  FITNESS FOR A PARTICULAR PURPOSE. See the GNU Lesser General Public</span></div>
<div class="line"><span class="comment"> *  License for more details.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span></div>
<div class="line"><span class="comment"> *  along with bitpit. If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><span class="comment"> *</span></div>
<div class="line"><span class="comment">\*---------------------------------------------------------------------------*/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line"><span class="preprocessor">#include &lt;mpi.h&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &quot;bitpit_PABLO.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line"><span class="preprocessor">#include &quot;PABLO_userDataComm.hpp&quot;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span>std;</div>
<div class="line"><span class="keyword">using namespace </span>bitpit;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// =================================================================================== //</span></div>
<div class="line"><span class="comment"></span><span class="comment">// =================================================================================== //</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code hl_class" href="classData.html">Data</a>{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">    vector&lt;double&gt; doubleData;</div>
<div class="line">    vector&lt;float&gt; floatData;</div>
<div class="line">    <a class="code hl_class" href="classData.html">Data</a>(uint32_t nocts): doubleData(nocts,0.0), floatData(nocts,0.0){};</div>
<div class="line">    <a class="code hl_class" href="classData.html">Data</a>(<a class="code hl_class" href="classData.html">Data</a>&amp; rhs){</div>
<div class="line">        this-&gt;doubleData = rhs.<a id="a2" name="a2"></a>doubleData;</div>
<div class="line">        this-&gt;floatData = rhs.<a id="a3" name="a3"></a>floatData;</div>
<div class="line">    }</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> run()</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> iter = 0;</div>
<div class="line">    <span class="keywordtype">int</span> dim = 2;</div>
<div class="line"> </div>
<div class="line">    <a id="_a4" name="_a4"></a><a class="code hl_class" href="classbitpit_1_1PabloUniform.html">PabloUniform</a> pablo6(2);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (iter=1; iter&lt;5; iter++){</div>
<div class="line">        pablo6.adaptGlobalRefine();</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">    pablo6.loadBalance();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">double</span> xc, yc;</div>
<div class="line">    xc = yc = 0.5;</div>
<div class="line">    <span class="keywordtype">double</span> radius = 0.25;</div>
<div class="line"> </div>
<div class="line">    uint32_t nocts = pablo6.getNumOctants();</div>
<div class="line">    uint32_t nghosts = pablo6.getNumGhosts();</div>
<div class="line">    <span class="comment">//vector&lt;double&gt; oct_data(nocts, 0.0), ghost_data(nghosts, 0.0);</span></div>
<div class="line">    <a class="code hl_class" href="classData.html">Data</a> octdata(nocts), ghostdata(nghosts);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nocts; i++){</div>
<div class="line">        vector&lt;array&lt;double,3&gt; &gt; nodes = pablo6.getNodes(i);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;4; j++){</div>
<div class="line">            <span class="keywordtype">double</span> x = nodes[j][0];</div>
<div class="line">            <span class="keywordtype">double</span> y = nodes[j][1];</div>
<div class="line">            <span class="keywordflow">if</span> ((<a id="a5" name="a5"></a><a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>((x-xc),2.0)+<a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>((y-yc),2.0) &lt;= <a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>(radius,2.0))){</div>
<div class="line">                <span class="comment">//oct_data[i] = 1.0;</span></div>
<div class="line">                octdata.doubleData[i] = 1.0;</div>
<div class="line">                octdata.floatData[i] = 1.0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nghosts; i++){</div>
<div class="line">        <a id="_a6" name="_a6"></a><a class="code hl_class" href="classbitpit_1_1Octant.html">Octant</a> *oct = pablo6.getGhostOctant(i);</div>
<div class="line">        vector&lt;array&lt;double,3&gt; &gt; nodes = pablo6.getNodes(oct);</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j=0; j&lt;4; j++){</div>
<div class="line">            <span class="keywordtype">double</span> x = nodes[j][0];</div>
<div class="line">            <span class="keywordtype">double</span> y = nodes[j][1];</div>
<div class="line">            <span class="keywordflow">if</span> ((<a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>((x-xc),2.0)+<a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>((y-yc),2.0) &lt;= <a class="code hl_function" href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a>(radius,2.0))){</div>
<div class="line">                <span class="comment">//ghost_data[i] = 1.0;</span></div>
<div class="line">                ghostdata.doubleData[i] = 1.0;</div>
<div class="line">                ghostdata.floatData[i] = 1.0;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    iter = 0;</div>
<div class="line">    pablo6.updateConnectivity();</div>
<div class="line">    pablo6.writeTest(<span class="stringliteral">&quot;pablo00006_double_iter&quot;</span>+to_string(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(iter)), octdata.doubleData);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> start = iter + 1;</div>
<div class="line">    <span class="keywordflow">for</span> (iter=start; iter&lt;start+25; iter++){</div>
<div class="line">        <span class="comment">//vector&lt;double&gt; oct_data_smooth(nocts, 0.0);</span></div>
<div class="line">        <a class="code hl_class" href="classData.html">Data</a> octdatasmooth(nocts);</div>
<div class="line">        vector&lt;uint32_t&gt; neigh, neigh_t;</div>
<div class="line">        vector&lt;bool&gt; isghost, isghost_t;</div>
<div class="line">        uint8_t iface, nfaces, codim;</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;nocts; i++){</div>
<div class="line">            neigh.clear();</div>
<div class="line">            isghost.clear();</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">for</span> (codim=1; codim&lt;dim+1; codim++){</div>
<div class="line">                <span class="keywordflow">if</span> (codim == 1){</div>
<div class="line">                    nfaces = 4;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (codim == 2){</div>
<div class="line">                    nfaces = 4;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">for</span> (iface=0; iface&lt;nfaces; iface++){</div>
<div class="line">                    pablo6.findNeighbours(i,iface,codim,neigh_t,isghost_t);</div>
<div class="line">                    neigh.insert(neigh.end(), neigh_t.begin(), neigh_t.end());</div>
<div class="line">                    isghost.insert(isghost.end(), isghost_t.begin(), isghost_t.end());</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="comment">//oct_data_smooth[i] = oct_data[i]/(neigh.size()+1);</span></div>
<div class="line">            octdatasmooth.doubleData[i] = octdata.doubleData[i]/(neigh.size()+1);</div>
<div class="line">            octdatasmooth.floatData[i] = octdata.floatData[i]/(neigh.size()+1);</div>
<div class="line">            <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j=0; j&lt;neigh.size(); j++){</div>
<div class="line">                <span class="keywordflow">if</span> (isghost[j]){</div>
<div class="line">                    <span class="comment">//oct_data_smooth[i] += ghost_data[neigh[j]]/(neigh.size()+1);</span></div>
<div class="line">                    octdatasmooth.doubleData[i] += ghostdata.doubleData[neigh[j]]/(neigh.size()+1);</div>
<div class="line">                    octdatasmooth.floatData[i] += ghostdata.floatData[neigh[j]]/(neigh.size()+1);</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span>{</div>
<div class="line">                    <span class="comment">//oct_data_smooth[i] += oct_data[neigh[j]]/(neigh.size()+1);</span></div>
<div class="line">                    octdatasmooth.doubleData[i] += octdata.doubleData[neigh[j]]/(neigh.size()+1);</div>
<div class="line">                    octdatasmooth.floatData[i] += octdata.floatData[neigh[j]]/(neigh.size()+1);</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">        pablo6.updateConnectivity();</div>
<div class="line">        pablo6.writeTest(<span class="stringliteral">&quot;pablo00006_iter&quot;</span>+to_string(<span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span><span class="keyword">&gt;</span>(iter)), octdatasmooth.doubleData);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">        UserDataComm&lt;Data&gt; data_comm(octdatasmooth, ghostdata);</div>
<div class="line">        pablo6.communicate(data_comm);</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        octdata.doubleData = octdatasmooth.doubleData;</div>
<div class="line">        octdata.floatData = octdatasmooth.floatData;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">    MPI_Init(&amp;argc,&amp;argv);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    <a id="a7" name="a7"></a><a class="code hl_define" href="group__common__macro.html#gacb5eef7cdb2adda3b65bfe01c66667a4">BITPIT_UNUSED</a>(argc);</div>
<div class="line">    <a class="code hl_define" href="group__common__macro.html#gacb5eef7cdb2adda3b65bfe01c66667a4">BITPIT_UNUSED</a>(argv);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> nProcs;</div>
<div class="line">    <span class="keywordtype">int</span> rank;</div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">    MPI_Comm_size(MPI_COMM_WORLD, &amp;nProcs);</div>
<div class="line">    MPI_Comm_rank(MPI_COMM_WORLD, &amp;rank);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">    nProcs = 1;</div>
<div class="line">    rank   = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Initialize the logger</span></div>
<div class="line">    log::manager().initialize(log::MODE_SEPARATE, <span class="keyword">false</span>, nProcs, rank);</div>
<div class="line">    log::cout() &lt;&lt; log::fileVerbosity(log::INFO);</div>
<div class="line">    log::cout() &lt;&lt; log::disableConsole();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Run the example</span></div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        run();</div>
<div class="line">    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception &amp;exception) {</div>
<div class="line">        log::cout() &lt;&lt; exception.what();</div>
<div class="line">        exit(1);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#if BITPIT_ENABLE_MPI==1</span></div>
<div class="line">    MPI_Finalize();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">}</div>
<div class="ttc" id="aclassbitpit_1_1Octant_html"><div class="ttname"><a href="classbitpit_1_1Octant.html">bitpit::Octant</a></div><div class="ttdoc">Octant class definition.</div><div class="ttdef"><b>Definition:</b> <a href="Octant_8hpp_source.html#l00089">Octant.hpp:89</a></div></div>
<div class="ttc" id="aclassbitpit_1_1PabloUniform_html"><div class="ttname"><a href="classbitpit_1_1PabloUniform.html">bitpit::PabloUniform</a></div><div class="ttdoc">PABLO Uniform is an example of user class derived from ParaTree to map ParaTree in a uniform (square/...</div><div class="ttdef"><b>Definition:</b> <a href="PabloUniform_8hpp_source.html#l00061">PabloUniform.hpp:62</a></div></div>
<div class="ttc" id="agroup__MathFunctions_html_gaf8584ed85f67d3f84fcbb39e3045a820"><div class="ttname"><a href="group__MathFunctions.html#gaf8584ed85f67d3f84fcbb39e3045a820">pow</a></div><div class="ttdeci">std::array&lt; T, d &gt; pow(std::array&lt; T, d &gt; &amp;x, double p)</div><div class="ttdef"><b>Definition:</b> <a href="MathOperators__array_8tpp_source.html#l00637">MathOperators_array.tpp:637</a></div></div>
<div class="ttc" id="agroup__common__macro_html_gacb5eef7cdb2adda3b65bfe01c66667a4"><div class="ttname"><a href="group__common__macro.html#gacb5eef7cdb2adda3b65bfe01c66667a4">BITPIT_UNUSED</a></div><div class="ttdeci">#define BITPIT_UNUSED(variable)</div><div class="ttdef"><b>Definition:</b> <a href="compiler_8hpp_source.html#l00063">compiler.hpp:63</a></div></div>
</div><!-- fragment --> </div><!-- contents -->

</div>
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<address class="footer"><small>
Generated on Fri Dec 29 2023 15:32:45 for bitpit by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.9.6
</small></address>
    <div id="footer" >
        <div class="middle">
            <div class="box-wrapper">
                <div class="box bitpit">
                    <p>
                    <strong><a href="/bitpit">bitpit</a></strong><br />
                    <a href="/bitpit/modules/overview.html">Overview</a><br />
                    <a href="/bitpit/downloads">Downloads</a>
                    </p>
                </div>
                <div class="box optimad">
                    <p>
                    <strong><a href="http://www.optimad.it">OPTIMAD Engineering Srl</a></strong><br />
                    <a href="http://www.optimad.it/corporate/spin-off/">About</a><br />
                    <a href="http://www.optimad.it/contact-us/">Contact us</a><br />
                    <a href="mailto:info@optimad.it">info@optimad.it</a>
                    </p>
                </div>
                <div class="box address">
                    <p>
                    <strong>Address</strong><br />
                    Via Agostino da Montefeltro 2<br />
                    10134 Torino<br />
                    Italy
                    </p>
                </div>
                <div class="box info">
                    <p>
                    <strong>Info</strong><br />
                    Capitale Sociale € 13.000,00 i.v.<br />
                    C.F. / P.Iva 09359170017<br />
                    Iscr. Reg. Impr. Torino - R.E.A. TO-1045102
                    </p>
                </div>
            </div>
        </div>
        <div class="legal">
            <p>
            © 2016-2021 OPTIMAD Engineering Srl  -  <a href="/bitpit/privacy.html">Privacy Policy</a>
            </p>
        </div>
    </div>
</div>
</body>
</html>
